<html>
  <head>
    <meta name="viewport" content="width=320, maximum-scale=1.0, user-scalable=no">
    <title>KATLA</title>
    <style>
      body {
        text-align: center;
        touch-action: none;
      }

      input[type=button] {
        -webkit-appearance: none;
        border: 0px;
        height: 3em;
        width: 2.5em;
        margin: 0.08em;
        text-align: center;
        padding: 0em;
      }

      button {
        -webkit-appearance: none;
        border: 0px;
        height: 3em;
        margin: 0.08em;
        text-align: center;
      }

      input[type=text] {
        height: 3rem;
        width: 3rem;
        margin: 0.2rem;
        padding: 0px;
        font-size: 2em;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <h1><a href="https://katla.vercel.app/">KATLA</a></h1> 
    <a href="https://github.com/mataherry/katla" style="text-decoration: none;">
      <svg height="24" aria-hidden="true" viewBox="0 0 16 16" version="1.1" width="24" data-view-component="true" class="octicon octicon-mark-github v-align-middle">
          <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
      </svg>
    </a>
    <button onclick="acak()">ACAK</button> <button onclick="belajar()">BELAJAR</button>
    <div id="kotak" style="margin-top: 1.2em"></div>
    <div id="papan" style="margin-top: 1.2em"></div>
    
    <script>
      var kotak = document.getElementById('kotak')
      var papan = document.getElementById('papan')

      init()

      function init() {
        buatKotak()
        buatPapan()
        baris = 0
        kolom = 0
        tebakan = []
        status = ''
      }

      function buatKotak() {
        kotak.innerHTML = ''
        for(var i = 0; i < 6; i++) {
          kotak.innerHTML += '<div>'
          for(var j = 0; j < 5; j++) {
            kotak.innerHTML += '<input id="kotak' + i + j + '" type="text" max-length="1" size="1" readonly>'
          }
          kotak.innerHTML += '</div>'
        }
      }

      function buatPapan() {
        var qwe = 'QWERTYUIOP'
        var asd = 'ASDFGHJKL'
        var zxc = 'ZXCVBNM'

        papan.innerHTML = '<div>'
        for(var i = 0; i < qwe.length; i ++) {
          papan.innerHTML += '<input id="papan' + qwe[i] + '" type="button" onclick="inset(this.value)" value="' + qwe[i] + '"></input>'
        }
        papan.innerHTML += '</div>'

        papan.innerHTML += '<div>'
        for(var i = 0; i < asd.length; i ++) {
          papan.innerHTML += '<input id="papan' + asd[i] + '" type="button" onclick="inset(this.value)" value="' + asd[i] + '"></input>'
        }
        papan.innerHTML += '</div>'

        papan.innerHTML += '<div>'
        papan.innerHTML += '<button onclick="periksa()">KIRIM</button>'
        for(var i = 0; i < zxc.length; i ++) {
          papan.innerHTML += '<input id="papan' + zxc[i] + '" type="button" onclick="inset(this.value)" value="' + zxc[i] + '"></input>'
        }
        papan.innerHTML += '<button onclick="hapus()">&#9003;</button>'
        papan.innerHTML += '</div>'
      }

      var baris = 0
      var kolom = 0
      function inset(b) {
        if (kolom === 5 || status === '22222') return
        document.getElementById('kotak' + baris + kolom).value = b.toUpperCase()
        if (tebakan[baris])
          tebakan[baris] += b.toLowerCase()
        else
          tebakan[baris] = b.toLowerCase()
        kolom++
      }

      function hapus() {
        if (kolom === 0 || status === '22222') return
        kolom--
        document.getElementById('kotak' + baris + kolom).value = ''
        tebakan[baris] = tebakan[baris].slice(0, -1)
      }

      var listKatla = []
      var jawaban = ''
      fetch('kata.json')
        .then(
          function(response) {
            if (response.status !== 200) {
              console.log('Looks like there was a problem. Status Code: ' +
                response.status);
              return;
            }

            response.json().then(function(data) {
              listKatla = data
              acak()
            });
          }
        )
        .catch(function(err) {
          console.log('Fetch Error :-S', err);
        });

      var tebakan = []
      var status = ''
      var sisa = ''
      function periksa() {
        if (tebakan[baris].length < 5) {
          alert('Tebakannya kurang!')
          return
        }

        if (listKatla.indexOf(tebakan[baris]) < 0) {
          alert('Tidak ada di kamus!')
          return
        }

        status = ''
        sisa = ''
        for(var i = 0; i < tebakan[baris].length; i++) {
          if (jawaban[i] === tebakan[baris][i]) {
            document.getElementById('kotak' + baris + i).style.background = 'seagreen'
            document.getElementById('papan' + tebakan[baris][i]).style.background = 'seagreen'
            status += '2'
          }
          else {
            status += '0'
            sisa += jawaban[i]
          }
        }

        for(var i = 0; i < tebakan[baris].length; i++) {
          if (status[i] === '2') {
            continue
          }
          else if (sisa.includes(tebakan[baris][i])) {
            document.getElementById('kotak' + baris + i).style.background = 'yellow'
            document.getElementById('papan' + tebakan[baris][i]).style.background = 'yellow'
            status[i] = '1'
            sisa = sisa.replace(tebakan[baris][i], '')
          }
          else {
            document.getElementById('kotak' + baris + i).style.background = 'grey'
            if(document.getElementById('papan' + tebakan[baris][i]).style.background === '')
              document.getElementById('papan' + tebakan[baris][i]).style.background = 'grey'
          }
        }
        kolom = 0
        baris++

        if (status === '22222') {
          alert('BAGUS!')
          return
        }

        if (baris > 5) {
          alert(jawaban.toUpperCase())
        }
      }

      function acak() {
        jawaban = listKatla[Math.floor(Math.random() * listKatla.length)]
        init()
      }

      function belajar() {
        var p = prompt('Pilih Katla', listKatla[Math.floor(Math.random() * listKatla.length)]);
        if (p) {
          jawaban = p
          init()
        }
      }
    </script>
  </body>
</html>
