<html>
  <head>
    <meta name="viewport" content="width=320, maximum-scale=1.0, user-scalable=no">
    <title>KATLA</title>
    <style>
      body {
        text-align: center;
        touch-action: none;
      }

      input[type=button] {
        -webkit-appearance: none;
        border: 0px;
        height: 3em;
        width: 2.5em;
        margin: 0.08em;
        text-align: center;
        padding: 0em;
      }

      button {
        -webkit-appearance: none;
        border: 0px;
        height: 3em;
        margin: 0.08em;
        text-align: center;
      }

      input[type=text] {
        height: 3rem;
        width: 3rem;
        margin: 0.2rem;
        padding: 0px;
        font-size: 2em;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <h1>KATLA</h1> 
    <a href="https://github.com/mataherry/katla">
      <svg height="24" aria-hidden="true" viewBox="0 0 16 16" version="1.1" width="24" data-view-component="true" class="octicon octicon-mark-github v-align-middle">
          <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
      </svg>
    </a>
    <button onclick="barlu()">ACAK</button> <button onclick="belajlar()">BELAJAR</button>
    <div id="kotlak" style="margin-top: 1.2em"></div>
    <div id="hurluf" style="margin-top: 1.2em"></div>
    
    <script>
      var kotlak = document.getElementById('kotlak')
      var hurluf = document.getElementById('hurluf')

      mulali()

      function mulali() {
        koslong()
        paplan()
        barlis = 0
        klolom = 0
        teblak = []
        status = ''
      }

      function koslong() {
        kotlak.innerHTML = ''
        for(var i = 0; i < 6; i++) {
          kotlak.innerHTML += '<div>'
          for(var j = 0; j < 5; j++) {
            kotlak.innerHTML += '<input id="kotlak' + i + j + '" type="text" max-length="1" size="1" readonly>'
          }
          kotlak.innerHTML += '</div>'
        }
      }

      function paplan() {
        var qwe = 'qwertyuiop'
        var asd = 'asdfghjkl'
        var zxc = 'zxcvbnm'

        hurluf.innerHTML = '<div>'
        for(var i = 0; i < qwe.length; i ++) {
          hurluf.innerHTML += '<input id="hurluf' + qwe[i] + '" type="button" onclick="inslet(this.value)" value="' + qwe[i].toUpperCase() + '"></input>'
        }
        hurluf.innerHTML += '</div>'

        hurluf.innerHTML += '<div>'
        for(var i = 0; i < asd.length; i ++) {
          hurluf.innerHTML += '<input id="hurluf' + asd[i] + '" type="button" onclick="inslet(this.value)" value="' + asd[i].toUpperCase() + '"></input>'
        }
        hurluf.innerHTML += '</div>'

        hurluf.innerHTML += '<div>'
        hurluf.innerHTML += '<button onclick="chleck()">KIRIM</button>'
        for(var i = 0; i < zxc.length; i ++) {
          hurluf.innerHTML += '<input id="hurluf' + zxc[i] + '" type="button" onclick="inslet(this.value)" value="' + zxc[i].toUpperCase() + '"></input>'
        }
        hurluf.innerHTML += '<button onclick="haplus()">&#9003;</button>'
        hurluf.innerHTML += '</div>'
      }

      var barlis = 0
      var klolom = 0
      function inslet(b) {
        if (klolom === 5 || status === '22222') return
        document.getElementById('kotlak' + barlis + klolom).value = b.toUpperCase()
        if (teblak[barlis])
          teblak[barlis] += b.toLowerCase()
        else
          teblak[barlis] = b.toLowerCase()
        klolom++
      }

      function haplus() {
        if (klolom === 0 || status === '22222') return
        klolom--
        document.getElementById('kotlak' + barlis + klolom).value = ''
        teblak[barlis] = teblak[barlis].slice(0, -1)
      }

      var listKatla = []
      var jawlab = ''
      fetch('kata.json')
        .then(
          function(response) {
            if (response.status !== 200) {
              console.log('Looks like there was a problem. Status Code: ' +
                response.status);
              return;
            }

            // Examine the text in the response
            response.json().then(function(data) {
              listKatla = data
              barlu()
            });
          }
        )
        .catch(function(err) {
          console.log('Fetch Error :-S', err);
        });

      var teblak = []
      var status = ''
      var sisa = ''
      function chleck() {
        if (teblak[barlis].length < 5) {
          alert('Tebakannya kurang!')
          return
        }

        if (listKatla.indexOf(teblak[barlis]) < 0) {
          alert('Tidak ada di kamus!')
          return
        }

        status = ''
        sisa = ''
        for(var i = 0; i < teblak[barlis].length; i++) {
          if (jawlab[i] === teblak[barlis][i]) {
            document.getElementById('kotlak' + barlis + i).style.background = 'seagreen'
            document.getElementById('hurluf' + teblak[barlis][i]).style.background = 'seagreen'
            status += '2'
          }
          else {
            status += '0'
            sisa += jawlab[i]
          }
        }

        for(var i = 0; i < teblak[barlis].length; i++) {
          if (status[i] === '2') {
            continue
          }
          else if (sisa.includes(teblak[barlis][i])) {
            document.getElementById('kotlak' + barlis + i).style.background = 'yellow'
            document.getElementById('hurluf' + teblak[barlis][i]).style.background = 'yellow'
            status[i] = '1'
            sisa = sisa.replace(teblak[barlis][i], '')
          }
          else {
            document.getElementById('kotlak' + barlis + i).style.background = 'grey'
            if(document.getElementById('hurluf' + teblak[barlis][i]).style.background === '')
              document.getElementById('hurluf' + teblak[barlis][i]).style.background = 'grey'
          }
        }
        klolom = 0
        barlis++

        if (status === '22222') {
          alert('BAGUS!')
          return
        }

        if (barlis > 5) {
          alert(jawlab.toUpperCase())
        }
      }

      function barlu() {
        jawlab = listKatla[Math.floor(Math.random() * listKatla.length)]
        mulali()
      }

      function belajlar() {
        var p = prompt('Pilih Katla', listKatla[Math.floor(Math.random() * listKatla.length)]);
        if (p) {
          jawlab = p
          mulali()
        }
      }
    </script>
  </body>
</html>
